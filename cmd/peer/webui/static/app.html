<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>P2P Mesh Chat</title>
    <!-- Layout shell relies on the consolidated themeable stylesheet. -->
    <link rel="stylesheet" href="/static/app.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body data-theme="dark">
    <!-- AppLayout: entire SPA composed of SideNav, Content column, Notifications rail -->
    <div class="app-layout">
      <!-- SideNav: workspace selector, quick destinations, global actions -->
      <aside class="side-nav" aria-label="Workspace navigation">
        <div class="logo">P2P Chat</div>
        <!-- Quick navigation between feature panels -->
        <nav class="nav-section" aria-label="Primary panels">
          <button class="nav-item" data-panel="chat">üí¨ Chat</button>
          <button class="nav-item" data-panel="files">üìÅ Files</button>
          <button class="nav-item" data-panel="settings">‚öôÔ∏è Settings</button>
        </nav>
        <!-- Global actions (theme switch + logout) -->
        <div class="nav-footer">
          <button id="theme-toggle" class="nav-item">Toggle Theme</button>
          <button id="logout-btn" class="nav-item danger">Logout</button>
        </div>
      </aside>

      <!-- Content pane: TopBar (presence, actions) + dynamic panels -->
      <main class="content">
        <!-- TopBar: presence pills, notification shortcut, quick actions -->
        <header class="top-bar">
          <div class="identity">
            <span class="label">Logged in as</span>
            <strong id="me-name">-</strong>
          </div>
          <div class="presence" id="presence" aria-live="polite"></div>
          <div class="top-bar-actions">
            <button id="theme-toggle-inline" class="pill" aria-label="Toggle theme">üåì</button>
            <button id="notifications-toggle" class="pill">üîî Notifications</button>
          </div>
        </header>

        <!-- Panel: Chat workspace (thread, composer, quick commands) -->
        <section id="panel-chat" class="panel is-active" aria-labelledby="panel-chat-title">
          <header class="chat-header">
            <div>
              <h2 id="panel-chat-title">Chat</h2>
              <p class="text-muted">Mesh-connected room with DM support.</p>
            </div>
            <div class="command-bar" id="command-buttons"></div>
            <input id="target" class="dm-field" placeholder="DM target (optional)" />
          </header>
          <section id="messages" class="message-list" aria-live="polite"></section>
          <!-- Composer block rendered/enhanced by ui/chat + components/composer -->
          <form id="composer" class="composer" autocomplete="off">
            <!-- Composer root gets a dedicated class so CSS can size the textarea + buttons evenly. -->
            <div id="composer-root" class="composer-grid"></div>
          </form>
          <div id="emoji-panel" class="emoji-panel" hidden></div>
        </section>

        <!-- Panel: File transfer management -->
        <section id="panel-files" class="panel" aria-labelledby="panel-files-title" aria-hidden="true">
          <header class="panel-header">
            <div>
              <h2 id="panel-files-title">File Transfers</h2>
              <p class="text-muted">Uploads & downloads shared across the mesh.</p>
            </div>
            <div class="pill-group" role="tablist">
              <button class="pill" data-filter="uploads">Uploads</button>
              <button class="pill" data-filter="downloads">Downloads</button>
            </div>
          </header>
          <div id="file-list" class="file-list" aria-live="polite"></div>
        </section>

        <!-- Panel: Settings & device preferences -->
        <section id="panel-settings" class="panel" aria-labelledby="panel-settings-title" aria-hidden="true">
          <header class="panel-header">
            <div>
              <h2 id="panel-settings-title">Settings</h2>
              <p class="text-muted">Profile, notifications, and device controls.</p>
            </div>
          </header>
          <div class="settings-grid" id="settings-grid"></div>
        </section>
      </main>

      <!-- Notifications drawer: actionable alerts (system, mentions) -->
      <aside id="notifications" class="notifications" aria-live="polite" aria-label="Notifications panel">
        <div class="notifications-header">
          <h2>Notifications</h2>
          <button id="notifications-close" aria-label="Close">‚úñ</button>
        </div>
        <div class="notifications-tabs">
          <button class="pill" data-stack="system">System</button>
          <button class="pill" data-stack="mentions">Mentions</button>
        </div>
        <div id="notifications-list" class="notifications-list"></div>
      </aside>
    </div>

    <!-- Entry module bootstraps store, transport, UI modules, and services. -->
    <script type="module" src="/static/app.js"></script>
  </body>
</html>
